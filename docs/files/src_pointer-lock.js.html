<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/pointer-lock.js - pointer-lock</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="pointer-lock"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Kiwi.Plugins.PointerLock.html">Kiwi.Plugins.PointerLock</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.PointerLock.PointerLock.html">Kiwi.Plugins.PointerLock.PointerLock</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Kiwi.html">Kiwi</a></li>
            
                <li><a href="../modules/Kiwi.Plugins.html">Kiwi.Plugins</a></li>
            
                <li><a href="../modules/Plugins.html">Plugins</a></li>
            
                <li><a href="../modules/PointerLock.html">PointerLock</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/pointer-lock.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
* Description about the main namespace that the plugin is in.
*
* @module Kiwi
* @submodule Plugins
* @namespace Kiwi.Plugins
* @class PointerLock
*/
Kiwi.Plugins.PointerLock = {
	/**
	* The name of this plugin.
	* @property name
	* @type String
	* @default &quot;MyPlugin&quot;
	* @public
	*/
	name:&quot;PointerLock&quot;,

	/**
	* The version of this plugin.
	* @property version
	* @type String
	* @default &quot;0.1.0&quot;
	* @public
	*/
	version:&quot;0.1.0&quot;,

	minimumKiwiVersion: &quot;1.0.0&quot;
};

/**
* Registers this plugin with the Global Kiwi Plugins Manager if it is avaiable.
* 
*/
Kiwi.PluginManager.register( Kiwi.Plugins.PointerLock );

/**
* This create method is executed when Kiwi Game that has been told
* to use this plugin reaches the boot stage of the game loop.
* @method create
* @param game{Kiwi.Game} The game that is current in the boot stage.
* @private 
*/
Kiwi.Plugins.PointerLock.create = function( game ) {
	console.log( &quot;Pointer Lock Plugin created in game&quot;, game.name );
};


/**
* @module Kiwi.Plugins
* @submodule PointerLock
* @namespace Kiwi.Plugins.PointerLock
*/


/**
* The PointerLock object manages pointer lock for your game.
* &lt;br&gt;&lt;br&gt;
* This object only requires a reference to the Game object to initialise.
*	It will otherwise set default values.
*	You may pass a single Game object instead of its standard params,
*	for example &quot;new Kiwi.Plugins.PointerLock.PointerLock( myGame )&quot;
*	instead of &quot;new Kiwi.Plugins.PointerLock.PointerLock( { game: myGame } )&quot;.
*	You must specify the entire params object if you wish to set other params.
* &lt;br&gt;&lt;br&gt;
* By default, when you create a new PointerLock object, it will trigger
*	pointer lock when the user clicks anywhere on the game area.
*	You can exit pointer lock by pressing ESC.
*	We provide this method because pointer lock must be activated
*	by user gesture.
* &lt;br&gt;&lt;br&gt;
* The PointerLock object tracks the X and Y movements of the mouse
*	and can fire custom functions as part of the user gesture.
*	By default this occurs whether the pointer is locked or not.
*	You may toggle this with the &quot;trackWhileUnlocked&quot; flag.
* &lt;br&gt;&lt;br&gt;
* You may define custom functions in the blank functions
*	&quot;runOnLock&quot;, &quot;runOnUnlock,&quot; &quot;runOnMouseMove&quot; and &quot;runOnLockError&quot;.
*
* @class PointerLock
* @constructor
* @param params {Object} Parameter object
*	@param params.game {Kiwi.Game} Current game object
*	@param [params.lockOnClick=true] {Boolean} Whether to always lock the game
*		when clicked
*	@param [params.trackWhileUnlocked=true] {Boolean} Whether to always
*		track mouse movement events
*	@param [params.runOnLock] {function} Function to run on pointer lock
*	@param [params.runOnUnlock] {function} Function to run on pointer unlock
*	@param [params.runOnLockError] {function} Function to run on error
*	@param [params.runOnMouseMove] {function} Function to run on mouse movement
* @return Kiwi.Plugins.PointerLock.PointerLock
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock = function( params ) {
	var _reportLockError,
		_reportLockChange;

	/**
	* DOM element on which the lock occurs
	* @property canvas
	* @type Object
	* @public
	* @since 0.1.0
	*/
	this.canvas = null;

	/**
	* Whether the canvas is currently locked
	* @property locked
	* @type Boolean
	* @public
	* @since 0.1.0
	*/
	this.locked = false;

	/**
	* Whether to lock the pointer if it is not locked and the game is clicked.
	* @property lockOnClick
	* @type Boolean
	* @default true
	* @public
	* @since 0.1.0
	*/
	this.lockOnClick = true;

	/**
	* Mouse delta in X axis; how far the mouse was last moved horizontally.
	*	This data is available to the &quot;runOnMouseMove&quot; method
	*	and should be used there.
	* @property movementX
	* @type Number
	* @default 0
	* @public
	* @since 0.1.0
	*/
	this.movementX = 0;

	/**
	* Mouse delta in Y axis; how far the mouse was last moved vertically.
	*	This data is available to the &quot;runOnMouseMove&quot; method
	*	and should be used there.
	* @property movementY
	* @type Number
	* @default 0
	* @public
	* @since 0.1.0
	*/
	this.movementY = 0;

	/**
	* Whether to track mouse deltas when the pointer is not locked.
	* @property trackWhileUnlocked
	* @type Boolean
	* @default true
	* @public
	* @since 0.1.0
	*/
	this.trackWhileUnlocked = true;



	if ( params.objType &amp;&amp; params.objType() === &quot;Game&quot; ) {
		this.canvas = params.stage.container;
	} else {
		this.canvas = params.game.stage.container;
		if ( params.lockOnClick === false ) {
			this.lockOnClick = false;
		}
		if ( params.trackWhileUnlocked === false ) {
			this.trackWhileUnlocked = false;
		}
		if ( typeof params.runOnLock === &quot;function&quot; ) {
			this.runOnLock = params.runOnLock;
		}
		if ( typeof params.runOnUnlock === &quot;function&quot; ) {
			this.runOnUnlock = params.runOnUnlock;
		}
		if ( typeof params.runOnLockError === &quot;function&quot; ) {
			this.runOnLockError = params.runOnLockError;
		}
		if ( typeof params.runOnMouseMove === &quot;function&quot; ) {
			this.runOnMouseMove = params.runOnMouseMove;
		}
	}

	if ( this.lockOnClick ) {
		this.clickGameToLock();
	}

	// Consolidate Pointer Lock API calls on DOM element
	this.canvas.requestPointerLock =
		this.canvas.requestPointerLock ||
		this.canvas.mozRequestPointerLock ||
		this.canvas.webkitRequestPointerLock;
	this.canvas.exitPointerLock =
		this.canvas.exitPointerLock ||
		this.canvas.mozExitPointerLock ||
		this.canvas.webtkitExitPointerLock;

	// Setup event listeners

	// Movement listener
	_reportMouseMove = this._reportMouseMove.bind( this );
	document.addEventListener( &quot;mousemove&quot;, _reportMouseMove, false );

	// Error listeners
	_reportLockError = this._reportLockError.bind( this );
	document.addEventListener( &quot;pointerlockerror&quot;,
		_reportLockError, false );
	document.addEventListener( &quot;mozpointerlockerror&quot;,
		_reportLockError, false );
	document.addEventListener( &quot;webkitpointerlockerror&quot;,
		_reportLockError, false );

	// Lock change listeners
	_reportLockChange = this._reportLockChange.bind( this );
	if ( &quot;onpointerlockchange&quot; in document ) {
		document.addEventListener( &quot;pointerlockchange&quot;,
			_reportLockChange, false );
	} else if ( &quot;onmozpointerlockchange&quot; in document ) {
		document.addEventListener( &quot;mozpointerlockchange&quot;,
			_reportLockChange, false );
	} else if ( &quot;onwebkitpointerlockchange&quot; in document ) {
		document.addEventListener( &quot;webkitpointerlockchange&quot;,
			_reportLockChange, false );
	}

	return this;
};


/**
* @method _reportLockChange
* @param event {Event}
* @since 0.1.0
* @private
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype._reportLockChange =
		function( event ) {
	if ( this.getPointerLockElement() === this.canvas ) {
		this.locked = true;
		this.runOnLock();
	} else {
		this.locked = false;
		if ( this.lockOnClick ) {
			this.clickGameToLock();
		}
		this.runOnUnlock();
	}
};


/**
* @method _reportLockError
* @param event {Event}
* @since 0.1.0
* @private
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype._reportLockError =
		function( event ) {
	console.warn( &quot;Pointer lock change failed&quot; );
	this.runOnLockError();
};


/**
* @method _reportMouseMove
* @param event {Event}
* @private
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype._reportMouseMove =
		function( event ) {
	if ( this.locked || this.trackWhileUnlocked ) {
		this.movementX =
			event.movementX ||
			event.mozMovementX ||
			event.webkitMovementX ||
			0;
		this.movementY =
			event.movementY ||
			event.mozMovementY ||
			event.webkitMovementY ||
			0;
		this.runOnMouseMove();
	}
};


/**
* Convenience method for quickly activating pointer lock.
*	When called, the game listens for a click anywhere on its surface,
*	then activates pointer lock.
* @method clickGameToLock
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.clickGameToLock =
		function() {
	this.canvas.onclick = (function() {
		this.enablePointerLock();

		// Disable click after activation
		this.canvas.onclick = function(){};
	}).bind( this );
};


/**
* Disables pointer lock.
*	In the event that you need to bypass safety checks,
*	you may directly call &quot;this.canvas.exitPointerLock()&quot;,
*	but this is not recommended.
* @method disablePointerLock
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.disablePointerLock = function() {
	if ( this.canvas === this.getPointerLockElement() ) {
		this.canvas.exitPointerLock();
	} else {
		console.warn( &quot;Pointer unlock failed: element not locked&quot; );
	}
};


/**
* Enables pointer lock.
*	In the event that you need to bypass safety checks,
*	you may directly call &quot;this.canvas.requestPointerLock()&quot;,
*	but this is not recommended.
* @method enablePointerLock
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.enablePointerLock = function() {
	var pointerLockElement = this.getPointerLockElement();

	// Check document for currently locked elements
	if ( pointerLockElement === this.canvas ) {
		console.warn( &quot;Pointer lock failed: already locked on target element&quot;);
	}
	if ( pointerLockElement != null ) {
		console.warn( &quot;Pointer lock failed: already locked on element&quot;,
			pointerLockElement );
		return;
	}

	// Call Pointer Lock
	this.canvas.requestPointerLock();
};


/**
* Returns the currently locked DOM element, or &quot;null&quot; if no element is locked.
* @method getPointerLockElement
* @return {Object} DOM element that is locked.
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.getPointerLockElement =
		function() {
	return document.pointerLockElement ||
		document.mozPointerLockElement ||
		document.webkitPointerLockElement;
};


/**
* Returns the type of object that this is.
* @method objType
* @return {string}
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.objType = function() {
	return &quot;PointerLock&quot;;
};


/**
* Empty function called whenever the pointer is locked.
*	Override this to perform game-specific functions.
*	Scope is always on the PointerLock object.
* @method runOnLock
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.runOnLock = function() {};


/**
* Empty function called whenever the pointer lock encounters an error.
*	Override this to perform game-specific functions.
*	Scope is always on the PointerLock object.
* @method runOnLockError
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.runOnLockError = function() {};


/**
* Empty function called whenever the pointer moves.
*	Override this to perform game-specific functions.
*	Scope is always on the PointerLock object.
* @method runOnMouseMove
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.runOnMouseMove = function() {};


/**
* Empty function called whenever the pointer is unlocked.
*	Override this to perform game-specific functions.
*	Scope is always on the PointerLock object.
* @method runOnUnlock
* @public
* @since 0.1.0
*/
Kiwi.Plugins.PointerLock.PointerLock.prototype.runOnUnlock = function() {};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
